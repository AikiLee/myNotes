# 红黑树

为了避免像AVL一样，在插入和删除的过程中频繁地调整全树的拓扑结构。设计出红黑树，其具有二叉搜索树的性质又满足红黑性

## 红黑性

1. 每个结点只能是红色或者黑色

2. 根结点为黑

3. 叶节点都是黑色（此处的叶子结点是NIL）

4. 不存在相邻的红节点

5. 从一个节点到该节点的子孙节点的所有路径上包含相同数目的黑节点（确保没有一条路径会比其他路径长出俩倍。因而，红黑树是相对是接近平衡的二叉树。）

**结论**：

- 1.从根到叶的最长路径不大于最短路径的两倍

- 2.n个结点的红黑树的高度$h <= 2log_2{n+1}$

## 基本操作：换色和旋转

换色即字面意思，为了保证满足红黑性，需要对相应的结点进行换色。

旋转，类似AVL的左旋右旋，需要注意的是，每次的换位都需要进行颜色交换

## 红黑树的插入

**新插入的红黑树结点为红色。**

对于插入，分四种情况：

1. 插入的为根： 若根和叶为黑，重新上色

2. 插入结点x后，若叔结点为红，对x的父节点一层和爷结点重新上色
![202203262242412022-03-26](https://s2.loli.net/2022/03/26/hx9Z5HlP8M2Nftp.png)

3. 插入结点x后，若叔结点非红，父节点为红，此时出现不平衡（连红，非弯折），需旋转
![202203262244162022-03-26](https://s2.loli.net/2022/03/26/4uScFwYrbhzjIGo.png)

4. 插入结点x后，若叔结点非红，父节点为红，此时出现不平衡（连红，弯折）需将其变直，再转为3去解决

## 红黑树的删除

对于红黑树的删除，我们主要分两种大情况，和很多的小情况。
这里再补充一下，再红黑树中，前驱和后继直接去找排序结果的前后结点即可（红黑树满足二叉搜索树性质）

### 删除的是红节点

1. 红节点为叶节点，直接删除

2. 红节点非叶节点，处理方法有以下两种

    - 找到后继结点，将后继结点与待删除结点交换，，然后删除后继结点即可

    - 找到前驱结点，交换，再删除前驱结点即可
    ![202203271915182022-03-27](https://s2.loli.net/2022/03/27/yEuZd58C4xJvc3F.png)

### 删除的是黑节点

由于黑结点的删除可能导致黑高的改变，所以这里的情况较为复杂，主要分为三种情况：

- (1)删除结点为叶节点
- (2)有一个子节点
- (3)有两个子节点

这里再补充一点，后继节点最多只可能有一个子节点
![202203271925122022-03-27](https://s2.loli.net/2022/03/27/mbEC9k5tzBGJRS6.png)
从图中可以发现40的后继只可能是50，

1. 删除结点含有两个子节点：这种情况可以转化为(2),具体的实现方法为将待删除结点与其后继结点交换，之后转为(2)进行处理
    ![202203271928592022-03-27](https://s2.loli.net/2022/03/27/9SeRVvQa8cfwkpu.png)

2. 删除结点含一个子节点：这个很简单，用子节点替代，并换色成黑色
    ![202203271932542022-03-27](https://s2.loli.net/2022/03/27/ZFqi7Xdl16e8VpU.png)

3. 删除一个叶节点：这种情况较为复杂，具体有7种情况。但我们需要明白，这些操作都是为了保证树的红黑性来进行的

    - a.删除结点的**兄弟结点为红**：这里直接就可以想象出，删除后两边黑高不同，于是我们就有了以下的处理方式：将父节点与兄弟结点换色，再旋转（具体情况，具体分析），最后再删除该节点。

    这里我们举例是删除左节点
    ![202203271944062022-03-27](https://s2.loli.net/2022/03/27/vCOhjpryG2dPU4H.png)
    这里删除的结点是左是右不影响，会分析即可

    - b.删除结点**兄弟节点为黑色，远侄子节点为红色**:①应该先将父节点和兄弟结点换色，②旋转，③变色，④删除结点
    ![202203271952492022-03-27](https://s2.loli.net/2022/03/27/1gYlm2sBa3TWLhI.png)

    - c.**兄弟节点为黑色，远侄子节点为黑色（NIL），近侄子节点为红色**：其主体变为了兄弟和近侄结点，我们通过换色+旋转，将其变成b的情况，之后的具体操作参照b，
    ![202203271955112022-03-27](https://s2.loli.net/2022/03/27/5eJQwbmX1DPV8fo.png)

    - d.**父节点为红色，兄弟节点是黑色，且兄弟节点的两个孩子是空节点**:父节点和兄弟结点换色，再删除结点即可
    ![202203272001272022-03-27](https://s2.loli.net/2022/03/27/qgFhnRG2PAQe1rO.png)

    - e.**父节点为黑色，兄弟节点为黑色，且兄弟节点的两个孩子是空节点**:将兄弟结点变红即可
    ![202203272002472022-03-27](https://s2.loli.net/2022/03/27/MwYzmHsOFPXuWcb.png)

## 渐进边界证明

包含n个内部节点的红黑树的高度是${\displaystyle {\text{O}}(\log n)}$

[证明过程](https://zh.wikipedia.org/wiki/%E7%BA%A2%E9%BB%91%E6%A0%91#%E6%B8%90%E8%BF%91%E8%BE%B9%E7%95%8C%E7%9A%84%E8%AF%81%E6%98%8E)

## 参考

1. [维基百科-红黑树](https://zh.wikipedia.org/wiki/%E7%BA%A2%E9%BB%91%E6%A0%91)

2. [图解红黑树](https://mp.weixin.qq.com/s/AgVeH6-00NwiMVAQjzYh3Q)
